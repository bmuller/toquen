#!/bin/bash -l
if [ -e "/home/<%= user %>/bootstrap.lock" ]; then exit 0; fi
DEBIAN_FRONTEND=noninteractive apt-get -y update
DEBIAN_FRONTEND=noninteractive apt-get -y upgrade
DEBIAN_FRONTEND=noninteractive apt-get -y dist-upgrade
DEBIAN_FRONTEND=noninteractive apt-get -y install ruby ruby-dev build-essential rubygems

gem install --no-rdoc --no-ri chef

echo Setting host variables...
echo "127.0.0.1     <%= host.properties.awsname %>" >> /etc/hosts
echo "<%= host.properties.awsname %>" > /etc/hostname
hostname "<%= host.properties.awsname %>"

touch /home/<%= user %>/bootstrap.lock
echo "Rebooting now, standby..."
reboot
